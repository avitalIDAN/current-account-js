<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מנהל הכנסות והוצאות</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl; /* תצוגת טקסט מימין לשמאל */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>מנהל הכנסות והוצאות</h1>
    
    <!-- טופס קלט -->
    <label for="amount">סכום:</label>
    <input type="number" id="amount" placeholder="הכנס סכום">
    <br><br>

    <label for="description">תיאור:</label>
    <input type="text" id="description" placeholder="הכנס תיאור">
    <br><br>

    <label for="paymentMethod">צורת תשלום:</label>
    <select id="paymentMethod">
        <option value="מזומן">מזומן</option>
        <option value="אשראי">אשראי</option>
        <option value="העברה בנקאית">העברה בנקאית</option>
    </select>
    <br><br>

    <!-- הכנסה או הוצאה -->
    <label>
        <input type="radio" name="type" value="income"> הכנסה
    </label>
    <label>
        <input type="radio" name="type" value="expense"> הוצאה
    </label>
    <br><br>

    <button onclick="addExpense()">הוסף</button>
    
    <!-- טבלת הכנסות והוצאות -->
    <h2>רשימת הכנסות והוצאות:</h2>
    <table id="expenseTable">
        <thead>
            <tr>
                <th>תאריך</th>
                <th>סכום</th>
                <th>תיאור</th>
                <th>צורת תשלום</th>
                <th>הכנסה</th>
                <th>הוצאה</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <h3 id="total">סך הכל: 0</h3>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-hebrew/1.0.0/moment.hebrew.min.js"></script>
    <script>
        

        const expenses = [];

        function addExpense() {
            const amountInput = document.getElementById('amount');
            const descriptionInput = document.getElementById('description');
            const paymentMethodInput = document.getElementById('paymentMethod');
            const typeInputs = document.getElementsByName('type');
            const amount = parseFloat(amountInput.value);
            const description = descriptionInput.value.trim();
            const paymentMethod = paymentMethodInput.value;
            let type = null;

            // בדיקה שהכנסה או הוצאה נבחרה
            for (const input of typeInputs) {
                if (input.checked) {
                    type = input.value;
                    break;
                }
            }

            if (isNaN(amount) || description === "" || type === null) {
                alert("אנא הזן סכום תקין, תיאור וצורת תשלום, ובחר הכנסה או הוצאה.");
                return;
            }

            // תאריך לועזי
            const gregorianDate = new Date().toLocaleDateString("he-IL");
            // תאריך עברי
            const hebrewDate = new Intl.DateTimeFormat('he-u-ca-hebrew', { dateStyle: 'full' }).format(new Date());
            // שילוב התאריכים
            const fullDate = `${gregorianDate} / ${hebrewDate}`;

            // הוספת ההוצאה/ההכנסה לרשימה הפנימית
            expenses.push({ date: fullDate, amount, description, paymentMethod, type });
            
            // const date = new Date().toLocaleDateString("he-IL");

            // // הוספת ההוצאה/ההכנסה לרשימה הפנימית
            // expenses.push({ date, amount, description, paymentMethod, type });

            // הוספת ההוצאה/ההכנסה לטבלה
            const tableBody = document.getElementById('expenseTable').querySelector('tbody');
            const row = tableBody.insertRow();
            row.insertCell(0).innerText = fullDate;
            row.insertCell(1).innerText = amount.toFixed(2);
            row.insertCell(2).innerText = description;
            row.insertCell(3).innerText = paymentMethod;
            row.insertCell(4).innerText = type === 'income' ? '✔' : '';
            row.insertCell(5).innerText = type === 'expense' ? '✔' : '';

            // איפוס שדות הקלט לאחר הוספה
            amountInput.value = '';
            descriptionInput.value = '';
            paymentMethodInput.value = 'מזומן';
            typeInputs.forEach(input => input.checked = false);

            updateTotal();
        }

        function updateTotal() {
            // חישוב סך ההכנסות וההוצאות
            const total = expenses.reduce((sum, expense) => {
                return sum + (expense.type === 'income' ? expense.amount : -expense.amount);
            }, 0);

            document.getElementById('total').innerText = `סך הכל: ${total.toFixed(2)}`;
        }

        // // פונקציה לחישוב תאריך עברי
        // function getHebrewDate() {
        //     const now = new Date();
        //     const options = { year: 'numeric', month: 'long', day: 'numeric', calendar: 'hebrew', numberingSystem: 'hebrew' };
        //     return new Intl.DateTimeFormat('he-IL-u-ca-hebrew', options).format(now);
        // }


        function getHebrewDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', calendar: 'hebrew', numberingSystem: 'hebrew' };
            let dateStr = new Intl.DateTimeFormat('he-IL-u-ca-hebrew', options).format(now);

            // המרת מספרים לאותיות עבריות עבור היום בחודש
            dateStr = replaceNumbersWithHebrew(dateStr);

            // המרת השנה העברית
            dateStr = replaceYearWithHebrew(dateStr);

            return dateStr;
        }

        // פונקציה להמרת המספרים לייצוג אותיות עבריות
        function replaceNumbersWithHebrew(str) {
            const hebrewNumbers = ['א', 'ב', 'ג', 'ד', 'ה', 'ו', 'ז', 'ח', 'ט', 'י', 'י"א', 'י"ב', 'י"ג', 'י"ד', 'ט"ו', 'ט"ז', 'י"ז', 'י"ח', 'י"ט', 'כ', 'כ"א', 'כ"ב', 'כ"ג', 'כ"ד', 'כ"ה', 'כ"ו', 'כ"ז', 'כ"ח', 'כ"ט', 'ל'];
            return str.replace(/\d{1,2}/, match => hebrewNumbers[parseInt(match) - 1]);
        }

        // פונקציה להמרת שנה מספרית לעברית מלאה (כגון "התשפ"ה")
        function replaceYearWithHebrew(str) {
            const yearNumber = str.match(/\d{4}/);
            if (yearNumber) {
                const hebrewYear = getHebrewYearString(parseInt(yearNumber[0]));
                str = str.replace(yearNumber[0], hebrewYear);
            }
            return str;
        }

        // פונקציה שמחזירה את השנה העברית כתיבה (לדוגמה: התשפ"ה)
        function getHebrewYearString(year) {
            const hebrewYears = {
                5784: 'התשפ"ד',
                5785: 'התשפ"ה',
                5786: 'התשפ"ו',
                // הוסף שנים לפי הצורך
            };
            return hebrewYears[year] || year.toString(); // אם השנה לא נמצאת, נשאיר את המספר
        }
    </script>
</body>
</html>
